<!DOCTYPE html>
<html>
<head>
  <title>Atidaryti Aplanką</title>
  <script src="https://p.trellocdn.com/power-up.min.js"></script>
</head>
<body>
<script>
window.TrelloPowerUp.initialize({
  'card-buttons': function(t) {
    return t.card('desc')
      .get('desc')
      .then(function(desc) {
        if (!desc) return [];

        // 1️⃣ Rask visas nuorodas (su tarpais)
        const regex = /open-folder:\/\/.+/gi;
        const matches = desc.match(regex);
        if (!matches) return [];

        return matches.map(function(linkRaw) {
          // 2️⃣ Išvalyk tikrą nuorodą (be ENTER gale ir \ -> /)
          const sanitizedLink = linkRaw
            .trim()                  // panaikina ENTER gale
            .replace(/\\/g, '/');   // keičia \ į /

          return {
            icon: 'https://cdn-icons-png.flaticon.com/512/716/716784.png',
            text: 'Atidaryti aplanką',
            callback: function(t) {
              // 3️⃣ Testas: galima laikinai įjungti alert, jei reikia
              // alert("Atidaromas kelias:\n" + sanitizedLink);
              window.location.href = sanitizedLink;
              return t.closePopup();
            }
          };
        });
      });
  }
});
</script>
</body>
</html>
